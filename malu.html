<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mundo da Malu üíñ | Super Miss√µes</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@400;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --pink: #ff85a2;
            --dark-pink: #ff477e;
            --purple: #7d5fff;
            --sky: #a2d2ff;
            --yellow: #feca57;
            --white: #ffffff;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Poppins', sans-serif;
            background: var(--sky);
            overflow-x: hidden;
        }

        /* Fundo Animado com Desenhos */
        .bg-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            background: linear-gradient(to bottom, #a2d2ff 0%, #ffdeeb 100%);
        }

        .cloud {
            position: absolute;
            font-size: 50px;
            opacity: 0.6;
            animation: float 10s infinite linear;
        }

        @keyframes float {
            from {
                transform: translateX(-100px);
            }

            to {
                transform: translateX(110vw);
            }
        }

        /* Dashboard Principal */
        .app-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--white);
            padding: 15px 25px;
            border-radius: 25px;
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: 3px solid var(--pink);
        }

        .clock-section {
            text-align: left;
            line-height: 1.2;
        }

        .clock-section #time {
            font-family: 'Fredoka One', cursive;
            color: var(--purple);
            font-size: 1.5rem;
        }

        .clock-section #date {
            color: var(--dark-pink);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .score-badge {
            background: var(--dark-pink);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            box-shadow: 0 4px 0 #a30031;
        }

        /* Grid de Miss√µes */
        .missions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            flex-grow: 1;
        }

        .card {
            background: var(--white);
            border-radius: 30px;
            padding: 20px;
            text-align: center;
            border: 4px solid transparent;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-10px);
            border-color: var(--yellow);
        }

        .card.complete {
            background: #d1ffdb;
            border-color: #2ecc71;
            opacity: 0.8;
        }

        .card img-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .card h3 {
            margin: 5px 0;
            font-size: 1rem;
            color: var(--purple);
        }

        .card .reward {
            font-weight: 800;
            color: var(--dark-pink);
            font-size: 0.9rem;
        }

        /* Sess√£o de Leitura */
        .reading-shelf {
            background: rgba(255, 255, 255, 0.8);
            margin-top: 20px;
            padding: 25px;
            border-radius: 30px;
            border: 4px dashed var(--purple);
            text-align: center;
        }

        .reading-shelf h2 {
            font-family: 'Fredoka One', cursive;
            color: var(--purple);
        }

        .book-grid {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .book {
            background: var(--purple);
            color: white;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            width: 120px;
            transition: 0.3s;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .book:hover {
            transform: rotate(-5deg) scale(1.1);
            background: var(--dark-pink);
        }

        /* Modais Modernos */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        /* Ajuste para o conte√∫do do Modal ficar dentro da tela */
        .modal-content {
            background: white;
            width: 95%;
            /* Ocupa quase toda a largura em telas pequenas */
            max-width: 500px;
            max-height: 95vh;
            overflow-y: auto;
            /* N√£o ultrapassa 90% da altura da tela */
            border-radius: 30px;
            /* Reduzi um pouco para telas menores */
            padding: 20px;
            text-align: center;
            position: relative;
            border: 6px solid var(--pink);
            display: flex;
            flex-direction: column;
            /* Organiza os itens em coluna */
            overflow: hidden;
            align-items: center;
            justify-content: center;
            /* Garante que nada escape das bordas arredondadas */
        }

        /* Ajuste para o bot√£o de boas-vindas n√£o ultrapassar */
        #welcome-modal .btn {
            font-size: 1.2rem;
            /* Reduzido levemente */
            padding: 12px 30px;
            width: 90%;
            /* Garante que fique dentro da margem */
            max-width: 300px;
        }

        /* Ajuste espec√≠fico para o leitor de livros */
        .book-reader {
            max-width: 800px;
            /* Permite ser mais largo em tablets/PCs */
            text-align: left;
        }

        /* √Årea de texto com rolagem interna */
        .page-content {
            flex: 1;
            flex-grow: 1;
            -webkit-overflow-scrolling: touch;
            /* Faz o texto ocupar o espa√ßo dispon√≠vel */
            overflow-y: auto;
            /* Adiciona rolagem se o texto for grande */
            margin: 10px 0;
            padding: 15px;
            font-size: 1rem;
            /* Tamanho confort√°vel para celular */
            line-height: 1.5;
            color: #444;
            background: #fff9fb;
            /* Um fundo sutil para destacar a leitura */
            border-radius: 15px;
            border: 2px solid #eee;
        }

        .page-num {
            text-align: center;
            color: var(--pink);
            font-weight: bold;
        }

        .timer-box {
            background: #eee;
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
            font-weight: bold;
            color: var(--dark-pink);
        }

        .btn {
            background: var(--purple);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: 0.3s;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Bot√£o Flutuante */
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--yellow);
            color: #333;
            border: 4px solid var(--white);
            padding: 15px 25px;
            border-radius: 50px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: 0.3s;
        }

        .floating-btn:hover {
            transform: scale(1.1) rotate(5deg);
            background: var(--purple);
            color: white;
        }

        /* Grid de Bot√µes de Curiosidades */
        .curiosity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .curiosity-item-btn {
            background: var(--sky);
            border: 2px solid var(--purple);
            padding: 10px;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .curiosity-item-btn:hover {
            background: var(--purple);
            color: white;
        }

        .curiosity-text-area {
            text-align: justify;
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
            display: none;
            /* Escondido at√© clicar em uma curiosidade */
        }

        /* Estilo para o contador de curiosidades do dia */
        .daily-limit-info {
            font-size: 0.8rem;
            color: var(--dark-pink);
            margin-bottom: 10px;
            font-weight: bold;
        }

        /* Scrollbar personalizada para o texto longo */
        .curiosity-text-area::-webkit-scrollbar {
            width: 8px;
        }

        .curiosity-text-area::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .curiosity-text-area::-webkit-scrollbar-thumb {
            background: var(--pink);
            border-radius: 10px;
        }

        body {
            /* Impede que o usu√°rio selecione textos ou imagens (comum em apps) */
            user-select: none;
            -webkit-user-select: none;
            /* Remove o scroll el√°stico no topo (iOS) */
            overscroll-behavior-y: contain;
        }

        .card,
        .btn,
        .curiosity-item-btn,
        .book {
            /* Feedback visual de toque r√°pido */
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.1s active;
        }

        .card:active,
        .btn:active {
            transform: scale(0.95);
            /* Efeito de clique f√≠sico */
        }

        /* Ajuste do cabe√ßalho para n√£o bater no "notch" (c√¢mera) dos celulares novos */
        header {
            padding-top: env(safe-area-inset-top);
            position: sticky;
            top: 10px;
            z-index: 100;
        }

        /* Deixar os modais com cara de "Sheet" (folha que sobe debaixo) no mobile */
        @media (max-width: 600px) {
            .modal-content {
                width: 100%;
                max-width: none;
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;
                position: absolute;
                bottom: 0;
                animation: slideUp 0.3s ease-out;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        /* Estilos do Quebra-Cabe√ßa */
        #puzzle-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            /* 5 colunas */
            gap: 2px;
            background: #ccc;
            border: 5px solid var(--purple);
            width: 300px;
            height: 300px;
            margin: 15px auto;
        }

        .puzzle-piece {
            background-color: var(--pink);
            background-size: 300px 300px;
            /* Tamanho total da imagem */
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .puzzle-piece.empty {
            background: #eee !important;
            cursor: default;
        }

        #game-timer {
            font-size: 1.5rem;
            font-family: 'Fredoka One';
            color: var(--dark-pink);
            margin-bottom: 10px;
        }

        /* Bot√£o de Fechar Popup */
        .close-popup {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            z-index: 100;
        }

        /* Bot√£o de Recupera√ß√£o Discreto */
        .btn-restore-hidden {
            position: fixed;
            bottom: 5px;
            right: 5px;
            opacity: 0.3;
            background: none;
            border: none;
            font-size: 10px;
            cursor: pointer;
            color: #ccc;
        }

        .btn-restore-hidden:hover {
            opacity: 1;
        }

        /* Design do Popup de Backup L√∫dico */
        .backup-popup {
            background: #e3f2fd;
            border: 4px solid var(--sky);
            border-radius: 25px;
            padding: 20px;
            text-align: center;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }

            70% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Anima√ß√£o de Brilho/Pulso */
        @keyframes pulse-gold {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(254, 202, 87, 0.7);
            }

            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 15px rgba(254, 202, 87, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(254, 202, 87, 0);
            }
        }

        .btn-ready {
            background: var(--yellow) !important;
            color: #333 !important;
            animation: pulse-gold 1.5s infinite;
            border: 3px solid white !important;
            font-size: 1.2rem !important;
        }
    </style>
</head>

<body>

    <div class="bg-elements">
        <div class="cloud" style="top: 10%; animation-duration: 15s;">‚òÅÔ∏è</div>
        <div class="cloud" style="top: 30%; animation-duration: 20s;">‚≠ê</div>
        <div class="cloud" style="top: 60%; animation-duration: 12s;">‚òÅÔ∏è</div>
    </div>

    <div class="app-container">
        <header>

            <meta name="apple-mobile-web-app-capable" content="yes">
            <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
            <meta name="apple-mobile-web-app-title" content="Mundo da Malu">
            <link rel="apple-touch-icon" href="icone-da-malu.png">


            <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
            <div class="clock-section">
                <div id="time">00:00:00</div>
                <div id="date">Carregando data...</div>
            </div>
            <div class="score-badge">
                üöÄ <span id="total-min">0</span> MINUTOS
            </div>

            <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        </header>

        <div class="missions-grid">
            <div class="card"
                onclick="completeMission(this, 45, 'üçº Cuidar da Lis', '<b>Por que isso te faz melhor?</b><br>Cuidar de um beb√™ exige paci√™ncia infinita e aten√ß√£o aos detalhes. Na medicina ou no direito, saber cuidar de quem √© fr√°gil te tornar√° uma profissional humana e respeitada! <br><br><i>Jesus t√° vendo se voc√™ cuidou com amor!</i>')">
                <div class="img-icon">üçº</div>
                <h3>Cuidar da Lis</h3>
                <span class="reward">+45 Minutos</span>
            </div>


            <div class="card"
                onclick="completeMission(this, 30, 'üßº Lavar a Lou√ßa', '<b>Por que isso te faz melhor?</b><br>Uma cirurgi√£ precisa de um ambiente 100% limpo e organiza√ß√£o total. Lavar a lou√ßa caprichada treina seu foco e disciplina com a limpeza! <br><br><i>Dra. Malu, as bact√©rias n√£o podem vencer essa lou√ßa!</i>')">
                <div class="img-icon">üßº</div>
                <h3>Lavar a Lou√ßa</h3>
                <span class="reward">+30 Minutos</span>
            </div>

            <div class="card"
                onclick="completeMission(this, 20, 'üßπ Varrer a Casa', '<b>Por que isso te faz melhor?</b><br>Varrer exige disciplina e garante que nada passe despercebido. Na advocacia, n√£o deixar poeira nos cantos √© como n√£o deixar erros nos processos! <br><br><i>Nada de esconder poeira sob o tapete, hein?</i>')">
                <div class="img-icon">üßπ</div>
                <h3>Varrer a Casa</h3>
                <span class="reward">+20 Minutos</span>
            </div>

            <div class="card"
                onclick="completeMission(this, 15, '‚ù§Ô∏è Ajudar a Tia e a Av√≥', '<b>Por que isso te faz melhor?</b><br>Ajudar quem est√° acamado desenvolve a escuta ativa. Uma grande advogada precisa ouvir o que ningu√©m diz para ganhar uma causa! <br><br><i>Ajudar os mais velhos planta sementes de sabedoria.</i>')">
                <div class="img-icon">üëµ</div>
                <h3>Ajudar a Tia e a Av√≥</h3>
                <span class="reward">+15 Minutos</span>
            </div>

            <div class="card"
                onclick="completeMission(this, 15, 'üë¥ Aten√ß√£o ao Av√¥', '<b>Por que isso te faz melhor?</b><br>Perguntar se algu√©m precisa de algo demonstra iniciativa. L√≠deres e CEOs n√£o esperam ordens, eles antecipam necessidades! <br><br><i>O Av√¥ fica feliz e seu car√°ter fica mais forte!</i>')">
                <div class="img-icon">üë¥</div>
                <h3>Perguntar ao Av√¥</h3>
                <span class="reward">+15 Minutos</span>
            </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button id="btn-jogo-inteligente" class="btn"
                style="background: var(--yellow); color: #333; font-size: 1.2rem; border: 3px solid var(--white); opacity: 0.5;"
                onclick="abrirJogoInteligente()">
                üéÆ Jogo Inteligente (Bloqueado)
            </button>
        </div>

        <div class="reading-shelf">
            <h2>üìö Biblioteca da Malu (M√≠n. 20 min)</h2>
            <div class="book-grid">
                <div class="book" onclick="startReading('advogada')">‚öñÔ∏è Advogada de Sucesso</div>
                <div class="book" onclick="startReading('medica')">ü©∫ M√©dica Cirurgi√£</div>
                <div class="book" onclick="startReading('arquiteta')">üèóÔ∏è Arquiteta do Futuro</div>
                <div class="book" onclick="startReading('piloto')">‚úàÔ∏è Piloto de Aeronave</div>
            </div>
        </div>
    </div>

    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <h1 id="alert-emoji" style="font-size: 4rem; margin: 0;">üôè</h1>
            <h2 id="alert-title">Aten√ß√£o!</h2>
            <p id="alert-msg"></p>
            <button class="btn" onclick="closeModal('alert-modal')">Vou falar a verdade!</button>
        </div>
    </div>

    <div id="reading-modal" class="modal">
        <div class="modal-content book-reader" style="position: relative;">
            <span class="close-popup" onclick="fecharLeitura()" style="position: absolute; top: 15px; right: 20px; font-weight: bold; font-size: 30px; color:
                var(--pink);">√ó</span>

            <h2 id="book-title" style="color: var(--purple); margin-right: 40px;"></h2>

            <div class="recording-status" id="rec-indicator">
                <div class="pulse-red"></div> Gravando sua leitura... üéôÔ∏è
            </div>

            <div class="page-content" id="page-content"></div>

            <div class="page-num">P√°gina <span id="current-page">1</span> de 10</div>

            <div style="display: flex; justify-content: center; gap: 5px; margin-top: 10px;">
                <button class="btn" onclick="changePage(-1)">‚¨ÖÔ∏è</button>
                <button class="btn" id="btn-gravacao" style="background: #ff477e;" onclick="toggleRecording()">üé§
                    Iniciar Leitura</button>
                <button class="btn" onclick="changePage(1)">‚û°Ô∏è</button>
            </div>

            <div class="timer-box" id="reading-timer-display" style="font-size: 0.9rem; text-align: center;">
                ‚è≥ O tempo s√≥ corre enquanto voc√™ grava: <span id="timer-count">10:00</span>
            </div>

            <button class="btn" id="finish-btn" style="width: 100%; margin-top: 10px;" disabled
                onclick="rewardReading()">
                Concluir e Ganhar Tempo! ‚ú®
            </button>
        </div>
    </div>

    <div id="backup-modal" class="modal">
        <div class="modal-content backup-popup">
            <h1 style="font-size: 4rem; margin: 0;">‚òÅÔ∏è</h1>
            <h2 style="color: var(--purple); font-family: 'Fredoka One';">Nuvem de Mem√≥rias!</h2>
            <p>Estou guardando suas conquistas de hoje com muito carinho...</p>
            <div style="width: 100%; background: #ddd; height: 10px; border-radius: 5px; margin-top: 10px;">
                <div
                    style="width: 100%; background: var(--sky); height: 100%; border-radius: 5px; animation: progress 2s linear;">
                </div>
            </div>
        </div>
    </div>

    <script>

        // For√ßar HTTPS para habilitar o microfone
        if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
            location.replace(`https:${location.href.substring(location.protocol.length)}`);
        }


        let attentionInterval;
        let attentionActive = false;
        let lastInteractionTime = Date.now();
        const INACTIVITY_LIMIT = 30000;
        let totalMinutes = 0;
        let readingTimer;
        let curiosityTimer;
        let timeLeft = 10 * 60; // Reduzido para 10 minutos (ajust√°vel)
        let curiosityTimeLeft = 4 * 60; // 4 minutos para curiosidades
        let currentPage = 1;
        let currentStoryKey = '';

        // Controles de Limite
        let curiositiesViewedToday = 0;
        const MAX_CURIOSITIES_PER_DAY = 2;
        let storyReadToday = false;
        let missionsCompletedCount = 0;
        const TOTAL_MISSIONS = 5;

        function updateClock() {
            const now = new Date();
            const days = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            document.getElementById('time').innerText = now.toLocaleTimeString();
            document.getElementById('date').innerText = `${days[now.getDay()]}, ${now.getDate()} de ${months[now.getMonth()]} de ${now.getFullYear()}`;
        }

        // Disparar popup de boas-vindas ao carregar a p√°gina
        window.onload = function () {
            document.getElementById('welcome-modal').style.display = 'flex';
        };
        setInterval(updateClock, 1000);
        updateClock();

        // Vari√°veis de Controle do Jogo
        let gameTimerInterval;
        let gameTimeLeft = 15 * 60;
        const PUZZLE_ROWS = 5;
        const PUZZLE_COLS = 5; // Total 25 pe√ßas (mais jog√°vel que 50 em celular)
        let pieces = [];

        const soundApplause = new Audio('https://www.soundjay.com/human/sounds/applause-01.mp3');

        // Atualize sua fun√ß√£o checkAllDone existente
        function checkAllDone() {
            const btnJogo = document.getElementById('btn-jogo-inteligente');

            // Verifica se todas as miss√µes foram conclu√≠das
            if (missionsCompletedCount >= TOTAL_MISSIONS && storyReadToday && curiositiesViewedToday >= MAX_CURIOSITIES_PER_DAY) {
                btnJogo.style.opacity = "1";
                btnJogo.innerText = "üéÆ Jogo Inteligente (LIBERADO!)";
                btnJogo.style.animation = "float 2s infinite ease-in-out";

                setTimeout(() => {
                    showFinalAuthorizationModal();
                }, 1500);
            }
        }

        function abrirJogoInteligente() {
            // 1. Verificar os status
            const missoesOk = missionsCompletedCount >= TOTAL_MISSIONS;
            const leituraOk = storyReadToday;
            const curiosidadesOk = curiositiesViewedToday >= MAX_CURIOSITIES_PER_DAY;

            // 2. Se tudo estiver pronto, abre o jogo
            if (missoesOk && leituraOk && curiosidadesOk) {
                document.getElementById('game-modal').style.display = 'flex';
                initPuzzle();
                startGameTimer();
                return;
            }

            // 3. Caso contr√°rio, atualiza o checklist visual
            const checkM = document.getElementById('check-missions');
            const checkL = document.getElementById('check-reading');
            const checkC = document.getElementById('check-curiosity');

            // Atualiza Miss√µes
            checkM.innerHTML = missoesOk ? "‚úÖ Todas as miss√µes feitas!" : `‚ùå Faltam ${TOTAL_MISSIONS - missionsCompletedCount} miss√µes`;
            checkM.style.color = missoesOk ? "green" : "red";

            // Atualiza Leitura
            checkL.innerHTML = leituraOk ? "‚úÖ Hist√≥ria lida!" : "‚ùå Ler hist√≥ria (20 min)";
            checkL.style.color = leituraOk ? "green" : "red";

            // Atualiza Curiosidades
            checkC.innerHTML = curiosidadesOk ? "‚úÖ Curiosidades visualizadas!" : `‚ùå Ver curiosidades (${curiositiesViewedToday}/${MAX_CURIOSITIES_PER_DAY})`;
            checkC.style.color = curiosidadesOk ? "green" : "red";

            // 4. Mostra o modal personalizado
            document.getElementById('game-locked-modal').style.display = 'flex';
        }

        function initPuzzle() {
            const container = document.getElementById('puzzle-container');
            container.innerHTML = '';
            pieces = [];

            // Criar array de pe√ßas (0 a 24)
            for (let i = 0; i < (PUZZLE_ROWS * PUZZLE_COLS); i++) {
                pieces.push(i);
            }

            // Embaralhar
            pieces.sort(() => Math.random() - 0.5);

            renderPuzzle();
        }

        function renderPuzzle() {
            const container = document.getElementById('puzzle-container');
            container.innerHTML = '';

            pieces.forEach((pieceIdx, currentPos) => {
                const div = document.createElement('div');
                div.className = 'puzzle-piece';

                if (pieceIdx === (PUZZLE_ROWS * PUZZLE_COLS) - 1) {
                    div.classList.add('empty');
                    div.innerText = '';
                } else {
                    // L√≥gica de posi√ß√£o da imagem (Usa uma foto da internet como exemplo)
                    const row = Math.floor(pieceIdx / PUZZLE_COLS);
                    const col = pieceIdx % PUZZLE_COLS;
                    div.style.backgroundImage = `url('https://api.dicebear.com/7.x/adventurer/svg?seed=Malu&backgroundColor=ff85a2')`;
                    div.style.backgroundPosition = `-${col * 60}px -${row * 60}px`;
                    div.innerText = pieceIdx + 1; // N√∫mero para ajudar a Malu
                    div.onclick = () => movePiece(currentPos);
                }
                container.appendChild(div);
            });
        }

        function movePiece(pos) {
            const emptyPos = pieces.indexOf((PUZZLE_ROWS * PUZZLE_COLS) - 1);
            const row = Math.floor(pos / PUZZLE_COLS);
            const emptyRow = Math.floor(emptyPos / PUZZLE_COLS);
            const col = pos % PUZZLE_COLS;
            const emptyCol = emptyPos % PUZZLE_COLS;

            // Verifica se a pe√ßa est√° adjacente ao espa√ßo vazio
            const isAdjacent = Math.abs(row - emptyRow) + Math.abs(col - emptyCol) === 1;

            if (isAdjacent) {
                [pieces[pos], pieces[emptyPos]] = [pieces[emptyPos], pieces[pos]];
                renderPuzzle();
                checkWin();
            }
        }

        function checkWin() {
            const win = pieces.every((val, i) => val === i);
            if (win) {
                clearInterval(gameTimerInterval);
                alert("INCR√çVEL! Voc√™ montou o quebra-cabe√ßa! +45 Minutos! üèÜ");
                totalMinutes += 45;
                document.getElementById('total-min').innerText = totalMinutes;
                closeModal('game-modal');
            }
        }

        function startGameTimer() {
            gameTimeLeft = 15 * 60;
            clearInterval(gameTimerInterval);
            gameTimerInterval = setInterval(() => {
                gameTimeLeft--;
                let m = Math.floor(gameTimeLeft / 60);
                let s = gameTimeLeft % 60;
                document.getElementById('game-timer').innerText = `${m}:${s < 10 ? '0' + s : s}`;

                if (gameTimeLeft <= 0) {
                    clearInterval(gameTimerInterval);
                    perderJogo();
                }
            }, 1000);
        }

        function perderJogo() {
            alert("O tempo acabou! Voc√™ perdeu 30 minutos. Tente ser mais r√°pida na pr√≥xima! ‚è≥");
            totalMinutes = Math.max(0, totalMinutes - 30);
            document.getElementById('total-min').innerText = totalMinutes;
            closeModal('game-modal');
        }

        function desistirJogo() {
            if (confirm("Tem certeza? Voc√™ perder√° 30 minutos!")) {
                perderJogo();
            }
        }

        function showFinalAuthorizationModal() {
            let authModal = document.getElementById('auth-modal');
            if (!authModal) {
                const modalHTML = `
                <div id="auth-modal" class="modal" style="display:flex">
                    <div class="modal-content" style="border: 10px solid var(--yellow); background: #fff;">
                        <h1 style="font-size: 5rem;">üèÜ</h1>
                        <h2 style="color: var(--dark-pink); font-family: 'Fredoka One';">MISS√ÉO CUMPRIDA!</h2>
                        <p style="font-size: 1.2rem; font-weight: bold;">Malu, voc√™ completou TUDO por hoje! Parab√©ns pela disciplina! ‚ú®</p>
                
                        <div style="background: #f0f0f0; padding: 20px; border-radius: 20px; margin: 20px 0; border: 3px dashed var(--purple); width: 100%;">
                            <button class="btn" style="background: #25D366; color: white; width: 100%; margin-bottom: 10px; font-size: 1.1rem;" onclick="gerarECompartilharCertificado()">
                                üìÑ EMITIR CERTIFICADO & ZAP üöÄ
                            </button>
                            <p style="font-size: 0.9rem; color: #666;">Envie para o Papai Hayden como prova!</p>
                        </div>

                        <button class="btn" onclick="closeModal('auth-modal')">Fechar</button>
                    </div>
                </div>`;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            } else {
                authModal.style.display = 'flex';
            }
        }




        function completeMission(el, min, title, msg) {
            if (!el.classList.contains('complete')) {
                // Vibra√ß√£o leve (estilo clique de iPhone/Android)
                if (navigator.vibrate) navigator.vibrate(10);

                el.classList.add('complete');
                totalMinutes += min;
                missionsCompletedCount++;
                document.getElementById('total-min').innerText = totalMinutes;
                document.getElementById('alert-title').innerText = title;
                document.getElementById('alert-msg').innerHTML = msg;
                document.getElementById('alert-modal').style.display = 'flex';
                checkAllDone();
            }
        }

        // 3. Sistema de Leitura com 10 P√°ginas de 20 Linhas
        const stories = {
            advogada: [
                "P√°gina 1: Maria Luiza estava no sexto ano quando percebeu que as palavras eram como pe√ßas de um quebra-cabe√ßa que podiam montar a justi√ßa. Naquela manh√£ de abril, prestes a fazer 12 anos, ela se pegou observando uma injusti√ßa no p√°tio da escola. Um colega havia sido acusado de algo que n√£o fez, e ningu√©m parecia disposto a ouvir o seu lado. Malu, com sua voz firme e olhar atento, decidiu intervir. Ela n√£o gritou, apenas organizou os fatos com uma clareza que deixou at√© os professores impressionados. Naquele momento, no fundo de seu cora√ß√£o, uma chama se acendeu: o Direito n√£o seria apenas uma profiss√£o, seria sua miss√£o de vida. Ela voltou para casa pensando em como as leis podiam proteger as pessoas, e come√ßou a pesquisar sobre grandes nomes da advocacia. A biblioteca da escola virou seu ref√∫gio preferido, onde ela passava horas lendo sobre casos hist√≥ricos.",
                "P√°gina 2: Com o passar dos meses, Maria Luiza se tornou a 'advogada oficial' da turma. Se algu√©m tinha um conflito, procurava a Malu. Ela adorava o desafio de entender os dois lados e encontrar uma solu√ß√£o que fosse justa para todos. Seu pai, Hayden, percebeu esse talento logo cedo e come√ßou a incentiv√°-la com livros sobre orat√≥ria e l√≥gica. Malu lia cada p√°gina com sede de conhecimento, sublinhando frases importantes e treinando seus discursos na frente do espelho. Ela sabia que, como uma jovem negra, precisaria ser duas vezes melhor, e isso n√£o a assustava, pelo contr√°rio, dava a ela um combust√≠vel extra. Ela come√ßou a entender que a advocacia exigia n√£o apenas falar bem, mas ouvir com o cora√ß√£o. Cada leitura era um degrau a mais na escada que ela estava construindo rumo ao seu futuro brilhante no tribunal.",
                "P√°gina 3: Os anos de ensino fundamental e m√©dio foram marcados por muita dedica√ß√£o. Malu nunca perdia um debate na escola. Ela se destacava pela forma como respeitava seus oponentes, mas destru√≠a argumentos fracos com fatos s√≥lidos. Seus professores diziam que ela tinha uma 'presen√ßa de palco' natural. Ela come√ßou a participar de simula√ß√µes da ONU para jovens, onde representava diferentes pa√≠ses e defendia direitos humanos globais. Foi nessas simula√ß√µes que ela percebeu que o mundo era vasto e cheio de problemas que precisavam de mentes brilhantes para serem resolvidos. Maria Luiza n√£o queria apenas ser uma advogada comum; ela queria ser a voz daqueles que a sociedade tentava silenciar. O Direito Penal e os Direitos Humanos tornaram-se suas √°reas favoritas, pois ali ela via a chance real de mudar vidas e corrigir erros sist√™micos.",
                "P√°gina 4: Quando chegou a hora do vestibular, Malu n√£o teve d√∫vidas. Ela queria a melhor faculdade de Direito do pa√≠s. Foram meses de estudo intenso, muitas vezes abdicando de festas para resolver quest√µes de hist√≥ria e filosofia. Ela se lembrava das palavras de seu pai sobre a import√¢ncia do foco. No dia da prova, ela estava calma. Ela sabia que estava preparada. Quando a lista de aprovados saiu, o nome 'Maria Luiza' estava no topo. A comemora√ß√£o em casa foi gigante! Ela seria a primeira da fam√≠lia a ingressar em uma carreira jur√≠dica t√£o prestigiada. Ao entrar na universidade, ela sentiu o peso da responsabilidade, mas tamb√©m a alegria da conquista. Ela agora era oficialmente uma estudante de Direito, pronta para desbravar os c√≥digos e as leis que regem a na√ß√£o, sempre mantendo seus princ√≠pios e sua identidade.",
                "P√°gina 5: A faculdade foi um desafio constante. Malu se deparou com teorias complexas e textos em latim que pareciam indecifr√°veis no in√≠cio. Mas ela n√£o desistiu. Ela formou um grupo de estudos com outros estudantes negros e juntos criaram um coletivo jur√≠dico para discutir o racismo estrutural nas leis brasileiras. Ela percebeu que a lei, muitas vezes, era aplicada de forma desigual, e decidiu que sua carreira seria pautada pela equidade. Ela conseguiu um est√°gio em um dos escrit√≥rios mais renomados da cidade, onde come√ßou arquivando processos, mas logo chamou a aten√ß√£o dos s√≥cios por suas an√°lises jur√≠dicas precisas. Ela passava as noites na biblioteca da faculdade, mergulhada em jurisprud√™ncias e doutrinas, preparando-se para o dia em que estaria do outro lado da bancada, defendendo seus pr√≥prios clientes com a mesma garra que demonstrava no est√°gio.",
                "P√°gina 6: Ap√≥s cinco anos de estudo intenso, chegou o momento do Exame da Ordem (OAB). Era a prova final que definiria se ela poderia ou n√£o exercer a profiss√£o. Malu se isolou do mundo por dois meses, revisando todo o conte√∫do acumulado. Ela sentia a press√£o, mas tamb√©m a confian√ßa de quem fez o dever de casa. No dia do exame, ela respondeu cada quest√£o com seguran√ßa. O resultado n√£o poderia ser diferente: aprovada de primeira! Agora, ela era a Dra. Maria Luiza. Ela comprou sua primeira beca e sentiu um orgulho imenso ao ver seu reflexo no espelho. Ela n√£o era mais apenas a menina que defendia os colegas no p√°tio; ela agora tinha o poder legal de lutar pela justi√ßa. Seu primeiro escrit√≥rio foi pequeno, mas sua reputa√ß√£o cresceu r√°pido devido √† sua √©tica inabal√°vel e sua dedica√ß√£o total a cada caso que aceitava.",
                "P√°gina 7: O primeiro grande caso da Dra. Maria Luiza foi uma a√ß√£o civil p√∫blica contra uma empresa que estava poluindo o rio de uma comunidade carente. Ningu√©m acreditava que uma jovem advogada rec√©m-formada pudesse vencer uma gigante corporativa com centenas de advogados experientes. Mas Malu tinha algo que eles n√£o tinham: a verdade e uma conex√£o real com as v√≠timas. Ela passou semanas na comunidade, ouvindo as hist√≥rias das fam√≠lias e coletando evid√™ncias. No tribunal, seu discurso foi emocionante e tecnicamente impec√°vel. Ela falou sobre o direito √† vida e √† sa√∫de, e como o lucro n√£o poderia estar acima da dignidade humana. O juiz proferiu a senten√ßa em favor da comunidade, e a not√≠cia se espalhou por todo o pa√≠s. Malu havia se tornado um s√≠mbolo de esperan√ßa e resist√™ncia no meio jur√≠dico.",
                "P√°gina 8: Com o sucesso do caso ambiental, a Dra. Maria Luiza foi convidada para dar palestras em universidades e eventos internacionais. Ela viajou para Nova York e Genebra, levando a voz do Brasil e das mulheres negras para os palcos globais. Ela nunca esqueceu suas ra√≠zes e sempre mencionava o apoio da fam√≠lia em seus discursos. Ela decidiu abrir seu pr√≥prio escrit√≥rio, focado em causas sociais e defesa de minorias. O escrit√≥rio 'Maria Luiza Advocacia' tornou-se um porto seguro para aqueles que se sentiam desamparados pelo sistema. Ela contratava jovens estagi√°rios de periferias, dando a eles a mesma oportunidade que um dia recebeu. Malu sabia que o sucesso s√≥ fazia sentido se ela pudesse abrir portas para outros que viessem depois dela, criando um ciclo de prosperidade e justi√ßa.",
                "P√°gina 9: A carreira da Dra. Maria Luiza atingiu um novo patamar quando ela foi indicada para ser Desembargadora. Era um cargo de extrema import√¢ncia no tribunal de justi√ßa. Ela analisou o convite com cuidado, sabendo que sua presen√ßa naquele tribunal seria hist√≥rica. Ao assumir o cargo, ela se tornou uma das poucas mulheres negras a ocupar um assento t√£o alto na magistratura. Seus votos eram conhecidos por serem t√©cnicos, humanos e profundamente fundamentados em princ√≠pios de igualdade. Ela n√£o apenas julgava processos; ela moldava o pensamento jur√≠dico do pa√≠s. Ela escreveu livros que se tornaram best-sellers, usados em faculdades de todo o mundo. Maria Luiza era agora uma autoridade m√°xima, respeitada por colegas, opositores e pelo povo, mantendo sempre a humildade e a vontade de aprender.",
                "P√°gina 10: Hoje, ao olhar para tr√°s, a Dra. Maria Luiza v√™ a menina de 11 anos que um dia resolveu uma briga de escola. Ela entende que cada hora de leitura, cada lou√ßa lavada e cada ajuda dada √† sua tia e aos seus av√≥s foram fundamentais para formar seu car√°ter e sua disciplina. Ela √© agora uma Ministra do Supremo Tribunal Federal, o cargo mais alto que um jurista pode alcan√ßar. Ela olha para o horizonte e sabe que o c√©u nunca foi o limite, pois ela aprendeu a voar atrav√©s do conhecimento. Sua hist√≥ria √© um farol para todas as meninas que, como ela, sonham grande. Malu provou que com amor, dedica√ß√£o e o apoio da fam√≠lia, qualquer sonho √© poss√≠vel de ser realizado. Ela termina o dia lendo um processo importante, mas com um sorriso no rosto, sabendo que a justi√ßa est√° em boas m√£os: as m√£os de Maria Luiza."
            ],
            medica: [
                "P√°gina 1: Maria Luiza sempre teve um carinho especial pela vida. Desde pequena, ela observava como a natureza se regenerava e como o corpo humano era uma m√°quina perfeita. Quando a pequena Lis nasceu, Malu sentiu uma responsabilidade nova. Ela queria entender cada choro, cada movimento e garantir que sua irm√£zinha crescesse com sa√∫de. No sexto ano, ela j√° se destacava nas feiras de ci√™ncias, apresentando projetos sobre o sistema circulat√≥rio com uma paix√£o que contagiava a todos. Ela come√ßou a sonhar com um estetosc√≥pio de verdade pendurado no pesco√ßo. Malu n√£o queria apenas ser m√©dica por status; ela queria curar as dores que via no mundo. Ela passava as tardes lendo sobre a hist√≥ria da medicina e sobre como as vacinas salvaram bilh√µes de pessoas. O conhecimento era como um rem√©dio que ela tomava todos os dias para fortalecer seu sonho.",
                "P√°gina 2: A disciplina de Malu em casa refletia seu desejo de ser cirurgi√£. Ela sabia que uma cirurgia exigia precis√£o e m√£os firmes, ent√£o ela treinava sua coordena√ß√£o motora em tudo o que fazia. Lavar a lou√ßa sem deixar um pingo de gordura era como limpar um campo cir√∫rgico. Ajudar sua tia acamada era sua primeira pr√°tica cl√≠nica, onde ela aprendia sobre empatia e paci√™ncia. Ela percebeu que a medicina come√ßava no cuidado di√°rio e no olhar atento √†s necessidades do outro. Hayden, seu pai, sempre dizia que uma grande m√©dica precisa ser, antes de tudo, uma grande pessoa. Malu levava isso a s√©rio. Ela come√ßou a estudar biologia avan√ßada por conta pr√≥pria, devorando enciclop√©dias e v√≠deos sobre anatomia. Cada nova descoberta sobre o corpo humano era uma vit√≥ria pessoal que a deixava mais pr√≥xima do seu jaleco branco.",
                "P√°gina 3: No ensino m√©dio, o foco de Maria Luiza era inabal√°vel. Enquanto muitos colegas se distra√≠am, ela estava focada em dominar a qu√≠mica e a f√≠sica, bases essenciais para a medicina moderna. Ela se tornou volunt√°ria em um hospital local nos fins de semana, apenas para observar a rotina dos profissionais. Ela via a correria do pronto-socorro e a calma necess√°ria nos centros cir√∫rgicos. Em vez de se assustar com o sangue ou com a press√£o, ela se sentia em casa. Ela descobriu que tinha uma calma natural em situa√ß√µes de emerg√™ncia. Malu come√ßou a escrever artigos para o jornal da escola sobre h√°bitos saud√°veis, incentivando seus colegas a se cuidarem. Ela j√° agia como uma m√©dica antes mesmo de entrar na faculdade, pois entendia que a preven√ß√£o era o melhor caminho para a sa√∫de coletiva. Sua determina√ß√£o era vis√≠vel para todos.",
                "P√°gina 4: O vestibular de medicina √© conhecido por ser um dos mais dif√≠ceis do mundo. Malu sabia disso e se preparou como uma verdadeira atleta. Ela criou um cronograma de estudos rigoroso, revisando conte√∫dos de manh√£, √† tarde e √† noite. Ela abriu m√£o de muitos momentos de lazer, mas sempre com um sorriso no rosto, pois sabia o que estava em jogo. No dia da prova, ela respirou fundo e lembrou de toda a dedica√ß√£o que teve em casa com suas miss√µes di√°rias. Quando saiu o resultado, seu nome estava na lista dos aprovados de uma universidade federal. Foi um dia de choro e alegria em fam√≠lia. Maria Luiza agora era uma futura m√©dica. Ela recebeu seu primeiro jaleco em uma cerim√¥nia emocionante, onde jurou dedicar sua vida ao servi√ßo da humanidade. A jornada estava apenas come√ßando, e ela estava pronta para os desafios da faculdade.",
                "P√°gina 5: A faculdade de medicina foi um per√≠odo de imers√£o total. Malu passava horas no laborat√≥rio de anatomia, estudando cada nervo e cada art√©ria do corpo humano. Ela se encantou com a complexidade da gen√©tica e com a precis√£o da farmacologia. No terceiro ano, ela come√ßou a frequentar as alas hospitalares como interna. Foi ali que ela teve seu primeiro contato real com pacientes graves. Dra. Maria Luiza, como os pacientes j√° a chamavam carinhosamente, destacava-se pela humanidade. Ela n√£o via apenas doen√ßas; ela via pessoas com hist√≥rias e fam√≠lias. Ela decidiu se especializar em Cirurgia Card√≠aca, a √°rea mais desafiadora da medicina. Ela passava as noites de plant√£o estudando t√©cnicas cir√∫rgicas inovadoras e treinando em simuladores de alta tecnologia. Ela queria ser a melhor para dar aos seus pacientes as melhores chances de vida.",
                "P√°gina 6: Ap√≥s a formatura e anos de resid√™ncia m√©dica exaustiva, Maria Luiza finalmente se tornou uma Cirurgi√£ Card√≠aca titulada. O caminho foi longo e exigiu sacrif√≠cios, mas cada vida salva compensava tudo. Ela se tornou especialista em cirurgias minimamente invasivas, usando pequenos rob√¥s para operar cora√ß√µes com uma precis√£o milim√©trica. Malu era uma das poucas mulheres negras nesse campo de elite, e ela usava sua posi√ß√£o para inspirar outros estudantes. Ela publicou pesquisas em revistas cient√≠ficas internacionais sobre novas formas de tratar arritmias complexas. Ela n√£o parava de estudar, pois a medicina evolu√≠a a cada segundo. Seu pai Hayden assistia orgulhoso √†s palestras da filha, lembrando-se de quando ela ganhava minutos de internet por ajudar em casa. A disciplina da inf√¢ncia havia se transformado em uma carreira de excel√™ncia mundial.",
                "P√°gina 7: Um momento marcante na carreira da Dra. Maria Luiza foi quando ela liderou o primeiro transplante de cora√ß√£o artificial em uma crian√ßa no pa√≠s. O caso era desesperador, e a tecnologia era nova. Muitos m√©dicos hesitaram, mas Malu, ap√≥s noites analisando os riscos e as possibilidades, decidiu prosseguir. A cirurgia durou 12 horas seguidas. Sob as luzes do centro cir√∫rgico, ela comandou sua equipe com uma serenidade impressionante. Cada movimento era calculado, cada ponto era perfeito. Quando o novo cora√ß√£o come√ßou a bater ritmicamente, um sil√™ncio de al√≠vio tomou conta da sala. A cirurgia foi um sucesso total e virou capa de jornais ao redor do mundo. Maria Luiza n√£o era apenas uma cirurgi√£; ela era uma pioneira, abrindo fronteiras na medicina e dando esperan√ßa a milhares de fam√≠lias que aguardavam por milagres.",
                "P√°gina 8: O reconhecimento internacional levou a Dra. Maria Luiza a chefiar o departamento de cirurgia de um dos maiores hospitais de Nova York. Ela agora gerenciava equipes de m√©dicos de todo o mundo, mas nunca perdeu sua ess√™ncia brasileira e o carinho com que tratava cada paciente. Ela criou um programa de interc√¢mbio para m√©dicos de pa√≠ses em desenvolvimento, permitindo que eles aprendessem as t√©cnicas mais modernas para levar de volta √†s suas comunidades. Malu tamb√©m se tornou uma defensora da sa√∫de p√∫blica, lutando para que as tecnologias que ela usava em hospitais de luxo chegassem tamb√©m aos hospitais comunit√°rios. Ela acreditava que o acesso √† sa√∫de de qualidade era um direito humano fundamental e usava sua influ√™ncia para pressionar governos a investirem mais em ci√™ncia e tecnologia para todos.",
                "P√°gina 9: Maria Luiza tornou-se Diretora da Organiza√ß√£o Mundial da Sa√∫de (OMS). Agora, sua influ√™ncia n√£o era apenas sobre pacientes individuais, mas sobre a sa√∫de de todo o planeta. Ela coordenou respostas globais a pandemias e liderou campanhas de erradica√ß√£o de doen√ßas em continentes inteiros. Ela era respeitada por l√≠deres mundiais e amada pelas popula√ß√µes que ela protegia. Mesmo com uma agenda lotada, ela fazia quest√£o de voltar ao Brasil todos os anos para visitar sua fam√≠lia e realizar cirurgias gratuitas em crian√ßas carentes. Ela nunca esqueceu que sua jornada come√ßou com o cuidado com a pequena Lis e com a aten√ß√£o dada √† sua tia e av√¥. Maria Luiza era a prova viva de que a medicina mais poderosa √© aquela feita com conhecimento t√©cnico de ponta e um cora√ß√£o transbordando de amor ao pr√≥ximo.",
                "P√°gina 10: Ao se aposentar da vida p√∫blica, Maria Luiza fundou a 'Funda√ß√£o Malu', dedicada a dar bolsas de estudo para meninas negras que sonham em seguir carreiras cient√≠ficas. Ela olha para as fotos de sua formatura e sente que cumpriu seu prop√≥sito. Ela √© agora uma lenda viva na medicina, com hospitais e universidades levando seu nome. Mas para ela, o maior t√≠tulo ainda √© o de filha e irm√£. Ela senta em sua varanda, olha para as estrelas e sorri, lembrando daquela p√°gina de HTML que seu pai criou para incentiv√°-la a ler. Ela sabe que cada minuto de leitura daquela √©poca foi o alicerce para as d√©cadas de sucesso que vieram depois. Maria Luiza termina sua hist√≥ria como come√ßou: sendo uma fonte de luz, cura e inspira√ß√£o para o mundo inteiro. Sua jornada √© eterna, pois vive em cada cora√ß√£o que ela ajudou a bater mais forte."
            ]
        };

        function startReading(key) {
            if (storyReadToday) {
                alert("Malu, voc√™ j√° leu sua hist√≥ria inspiradora de hoje! üìö");
                return;
            }
            currentStoryKey = key;
            currentPage = 1;
            timeLeft = 10 * 60;

            document.getElementById('book-title').innerText = "Lendo: " + key.toUpperCase();
            updatePage();
            document.getElementById('reading-modal').style.display = 'flex';
            document.getElementById('finish-btn').disabled = true;

            startTimers();

            rewardSoundPlayed = false;
        }

        document.addEventListener("visibilitychange", function () {
            if (document.hidden && !attentionActive && timeLeft > 0 && currentStoryKey !== '') {
                triggerAttentionPopup("Malu, n√£o saia da p√°gina! üå∏", "A leitura precisa ser feita sem trocar de aba para contar o tempo.");
            }
        });

        // Registra qualquer intera√ß√£o (Toque, Mouse ou Teclado)
        function registrarInteracao() {
            lastInteractionTime = Date.now();
        }

        document.addEventListener("mousemove", registrarInteracao);
        document.addEventListener("keydown", registrarInteracao);
        document.addEventListener("touchstart", registrarInteracao);

        // O cron√¥metro agora s√≥ funciona se isRecording for true
        function startTimers() {
            clearInterval(readingTimer);
            readingTimer = setInterval(() => {
                if (!attentionActive && isRecording && timeLeft > 0) { // TRAVA: isRecording obrigat√≥rio
                    timeLeft--;
                    updateTimerDisplay();

                    if (Date.now() - lastInteractionTime > INACTIVITY_LIMIT) {
                        triggerAttentionPopup("Malu, voc√™ ainda est√° lendo? üëÄ", "O tempo parou porque n√£o detectamos movimento.");
                    }
                }
            }, 1000);
        }

        let timerInterval;

        // Altera√ß√£o na fun√ß√£o do Timer para respeitar a grava√ß√£o
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                // O tempo s√≥ desce se estiver gravando!
                if (isRecording && timeLeft > 0) {
                    timeLeft--;
                    updateTimerDisplay();
                }
            }, 1000);
        }

        // 1. Bloqueio de Atualiza√ß√£o/Fechamento
        window.addEventListener('beforeunload', (event) => {
            event.preventDefault();
            event.returnValue = "Malu, voc√™ ainda n√£o terminou suas miss√µes! Quer mesmo sair?";
        });

        // 2. L√≥gica de Grava√ß√£o
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;

        let audioUrlParaEnviar = null;

        async function toggleRecording() {
            if (!isRecording) {
                try {
                    // Verifica se o navegador suporta getUserMedia
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        alert("Seu navegador n√£o suporta grava√ß√£o de √°udio ou voc√™ est√° em um site sem HTTPS (seguran√ßa).");
                        return;
                    }

                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
                        audioUrlParaEnviar = URL.createObjectURL(audioBlob);
                    };

                    mediaRecorder.start();
                    isRecording = true;
                    document.getElementById('btn-gravacao').innerText = "üõë Parar Leitura";
                    document.getElementById('rec-indicator').style.display = 'flex';
                } catch (err) {
                    console.error("Erro ao acessar microfone:", err);
                    // Se o erro for de permiss√£o negada
                    if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                        mostrarAviso("Microfone Bloqueado", "Malu, clique no cadeado l√° em cima perto do endere√ßo do site e permita o uso do microfone! üéôÔ∏è", "‚ö†Ô∏è");
                    } else {
                        alert("Erro ao ligar o microfone. Verifique se o site tem HTTPS.");
                    }
                }
            } else {
                if (mediaRecorder && mediaRecorder.state !== "inactive") {
                    mediaRecorder.stop();
                }
                isRecording = false;
                document.getElementById('btn-gravacao').innerText = "‚úÖ Leitura Gravada!";
                document.getElementById('btn-gravacao').style.background = "#2ecc71";
                document.getElementById('rec-indicator').style.display = 'none';
                checkReadyToFinish();
            }
        }

        // 3. Efeito de P√°gina e Ergonomia
        function changePage(direction) {
            const content = document.getElementById('page-content');
            content.classList.add('page-flip-anim');

            setTimeout(() => {
                if (direction === 1 && currentPage < 10) currentPage++;
                if (direction === -1 && currentPage > 1) currentPage--;

                updatePage();
                content.scrollTop = 0; // Volta o scroll pro topo na nova p√°gina
                content.classList.remove('page-flip-anim');
            }, 300);
        }

        function checkReadyToFinish() {
            // O bot√£o deve ativar se o tempo acabou OU se ela j√° gravou o suficiente
            if (timeLeft <= 0 && (isRecording || audioChunks.length > 0)) {
                document.getElementById('finish-btn').disabled = false;
            }
        }

        let rewardSoundPlayed = false; // Vari√°vel de controle para o som tocar s√≥ uma vez

        function updateTimerDisplay() {
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            document.getElementById('timer-count').innerText = `${m}:${s < 10 ? '0' + s : s}`;

            if (timeLeft <= 0) {
                document.getElementById('reading-timer-display').innerHTML = "‚úÖ Tempo m√≠nimo atingido!";

                if (audioChunks.length > 0 || isRecording) {
                    const finishBtn = document.getElementById('finish-btn');

                    // Se o bot√£o ainda estava desativado, significa que acabamos de liberar
                    if (finishBtn.disabled) {
                        finishBtn.disabled = false;
                        finishBtn.classList.add('btn-ready');
                        finishBtn.innerHTML = "CONCLUIR E GANHAR TEMPO! ‚ú®";

                        // Toca os aplausos para celebrar!
                        if (!rewardSoundPlayed) {
                            soundApplause.play().catch(e => console.log("√Åudio bloqueado pelo navegador at√© intera√ß√£o."));
                            rewardSoundPlayed = true;
                        }
                    }
                }
            }
        }

        function triggerAttentionPopup(titulo, mensagem) {
            if (attentionActive) return; // Evita abrir v√°rios popups

            attentionActive = true;
            const attModal = `
            <div id="attention-modal" class="modal" style="display:flex; z-index:3000;">
                <div class="modal-content" style="border-color: var(--yellow);">
                    <h1 style="font-size: 3rem;">üëÄ</h1>
                    <h2 style="font-family: 'Fredoka One'; color: var(--purple);">${titulo}</h2>
                    <p>${mensagem}</p>
                    <button class="btn" style="background: var(--purple);" onclick="resumeReading()">Estou aqui! Continuar üìñ</button>
                </div>
            </div>`;
            document.body.insertAdjacentHTML('beforeend', attModal);
        }

        function resumeReading() {
            attentionActive = false;
            registrarInteracao(); // Reseta o contador de inatividade ao voltar
            const modal = document.getElementById('attention-modal');
            if (modal) modal.remove();
        }

        // Substitui√ß√£o do Alert
        function mostrarAviso(titulo, mensagem, emoji = "üå∏") {
            document.getElementById('custom-alert-title').innerText = titulo;
            document.getElementById('custom-alert-message').innerText = mensagem;
            document.getElementById('custom-alert-emoji').innerText = emoji;
            document.getElementById('custom-alert-modal').style.display = 'flex';
        }

        // Substitui√ß√£o da fun√ß√£o fecharLeitura (Imagem 4)
        function fecharLeitura() {
            const msg = "Malu, se fechar agora o tempo da hist√≥ria vai recome√ßar. Quer mesmo sair? ü•∫";
            document.getElementById('custom-confirm-message').innerText = msg;
            document.getElementById('custom-confirm-modal').style.display = 'flex';

            // Configura o que o bot√£o "Sim" do SEU MODAL vai fazer
            document.getElementById('confirm-yes').onclick = function () {
                clearInterval(readingTimer);
                timeLeft = 600; // Reseta para 10 min
                updateTimerDisplay();

                if (isRecording) {
                    toggleRecording(); // Desliga o microfone
                }

                closeModal('custom-confirm-modal');
                closeModal('reading-modal');
            };
        }

        // Ajuste na fun√ß√£o perderJogo (Para n√£o usar alert nativo)
        function perderJogo() {
            mostrarAviso("Tempo Esgotado!", "Voc√™ perdeu 30 minutos. Tente ser mais r√°pida na pr√≥xima! ‚è≥", "üò¢");
            totalMinutes = Math.max(0, totalMinutes - 30);
            document.getElementById('total-min').innerText = totalMinutes;
            closeModal('game-modal');
        }

        // Fun√ß√µes auxiliares (reutilizadas do seu c√≥digo original)
        function updatePage() {
            const storyArr = stories[currentStoryKey] || stories['advogada'];
            document.getElementById('page-content').innerHTML = `<p style="text-align: justify; margin: 0;">${storyArr[currentPage - 1]}</p>`;
            document.getElementById('current-page').innerText = currentPage;
        }
        function nextPage() { if (currentPage < 10) { currentPage++; updatePage(); } }
        function prevPage() { if (currentPage > 1) { currentPage--; updatePage(); } }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function openCuriosities() { updateCuriosityHeader(); document.getElementById('curiosity-display').style.display = 'none'; document.getElementById('curiosity-buttons').style.display = 'grid'; document.getElementById('curiosity-modal').style.display = 'flex'; }
        function updateCuriosityHeader() {
            const modalContent = document.querySelector('#curiosity-modal .modal-content');
            let limitInfo = document.getElementById('limit-info');
            if (!limitInfo) {
                limitInfo = document.createElement('div');
                limitInfo.id = 'limit-info';
                limitInfo.className = 'daily-limit-info';
                modalContent.insertBefore(limitInfo, document.getElementById('curiosity-buttons'));
            }
            limitInfo.innerText = `Voc√™ j√° viu ${curiositiesViewedToday} de ${MAX_CURIOSITIES_PER_DAY} curiosidades de hoje!`;
        }

        function nextPage() { if (currentPage < 10) { currentPage++; updatePage(); } }
        function prevPage() { if (currentPage > 1) { currentPage--; updatePage(); } }

        function rewardReading() {
            totalMinutes += 30;
            storyReadToday = true;
            document.getElementById('total-min').innerText = totalMinutes;
            closeModal('reading-modal');
            checkAllDone();
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // Vari√°veis de controle para o limite di√°rio

        const curiosidadesReais = {
            direito1: `Voc√™ sabia que a advocacia √© uma das profiss√µes mais antigas da humanidade? O primeiro c√≥digo de leis escrito foi o C√≥digo de Hamurabi, h√° quase 4.000 anos, na Mesopot√¢mia! Imagine viver numa √©poca onde n√£o existiam advogados. Se algu√©m pegasse seu brinquedo, n√£o tinha para quem reclamar! Hamurabi decidiu que o mundo precisava de ordem. Na Roma Antiga, os advogados eram t√£o respeitados que n√£o podiam cobrar dinheiro; eles trabalhavam pela honra e pela gl√≥ria de ajudar as pessoas. Malu, uma advogada n√£o apenas l√™ livros, ela √© uma "detetive das palavras". Ela precisa encontrar o erro que ningu√©m mais viu para provar a verdade. Hoje em dia, existem advogados especialistas em coisas que voc√™ nem imagina, como Direito Espacial (leis para quem vai para a Lua!) e Direito Digital (leis para a internet). Ser advogada exige que voc√™ seja uma excelente leitora, porque cada p√°gina de um processo pode esconder a pe√ßa do quebra-cabe√ßa que salva uma pessoa inocente. Imagine-se num tribunal, com uma beca preta elegante, falando para um juiz e convencendo todo mundo com a sua intelig√™ncia. Isso n√£o √© apenas um trabalho, √© o superpoder de usar a voz para trazer justi√ßa ao mundo!`,

            medicina1: `A medicina √© cheia de mist√©rios! Sabia que o primeiro estetosc√≥pio foi inventado por um m√©dico que tinha vergonha de encostar o ouvido no peito das pacientes? Em 1816, o Dr. Ren√© Laennec enrolou um peda√ßo de papel e percebeu que o som do cora√ß√£o ficava muito mais forte! Antes disso, os m√©dicos eram quase "adivinhos". Dra. Malu, voc√™ sabia que dentro do seu corpo existe um ex√©rcito de c√©lulas que nunca dorme? Os m√©dicos s√£o como os generais desse ex√©rcito. Uma curiosidade incr√≠vel: as cirurgias hoje podem ser feitas por rob√¥s controlados por m√©dicos a quil√¥metros de dist√¢ncia! Um m√©dico no Brasil pode operar algu√©m no Jap√£o. Isso exige que a m√©dica tenha m√£os de artista e nervos de a√ßo. Cada batida do cora√ß√£o de um paciente √© uma m√∫sica que s√≥ o m√©dico entende. Na faculdade de medicina, voc√™ aprende que o corpo humano √© mais complexo que qualquer computador do mundo. O c√©rebro tem bilh√µes de neur√¥nios mandando mensagens na velocidade da luz! Estudar medicina √© como aprender uma l√≠ngua m√°gica que permite que voc√™ entenda o que o corpo est√° dizendo sem ele usar palavras. √â a ci√™ncia de salvar o amanh√£ de algu√©m.`,

            arquitetura1: `Arquitetos s√£o os verdadeiros magos que transformam papel em montanhas de concreto! Voc√™ sabia que existem cidades inteiras sendo projetadas para flutuar no oceano? Com o n√≠vel do mar subindo, arquitetos na Coreia do Sul est√£o criando ilhas artificiais que sobem e descem com as ondas. Um arquiteto n√£o pensa s√≥ em paredes, Malu. Ele pensa em como o sol vai bater na sua janela de manh√£ para te acordar feliz. Sabia que a Grande Muralha da China foi constru√≠da usando arroz doce na mistura do cimento? Isso a deixou t√£o forte que dura milhares de anos! Arquitetura √© a mistura perfeita de matem√°tica, arte e psicologia. Voc√™ precisa saber se as pessoas v√£o se sentir abra√ßadas por um pr√©dio ou se v√£o se sentir perdidas. Existem pr√©dios em Dubai que giram 360 graus! Cada morador pode escolher a vista que quer ter da janela naquele dia. Ser arquiteta do futuro, como voc√™, significa criar casas que produzem sua pr√≥pria energia e que podem at√© ser impressas em impressoras 3D gigantes!`,

            piloto1: `Voc√™ j√° se perguntou como um avi√£o de 500 toneladas consegue ficar no ar como se fosse um passarinho? A resposta √© pura ci√™ncia e coragem! Os pilotos de avi√£o precisam entender de f√≠sica, clima e at√© um pouco de psicologia para manter todo mundo calmo. Sabia que o vidro da frente de um avi√£o √© t√£o forte que pode aguentar o impacto de um p√°ssaro a 800 km/h sem quebrar? E uma curiosidade que quase ningu√©m sabe: os pilotos e os copilotos nunca comem a mesma comida durante o voo! Isso √© para garantir que, se um passar mal, o outro esteja bem para pousar. Voar √© como dirigir em um mapa 3D onde n√£o existem estradas vis√≠veis, apenas rios de ar chamados correntes de jato. Quando voc√™ √© piloto, o mundo inteiro vira o seu quintal. Voc√™ pode tomar caf√© em Paris e jantar em Nova York. O painel de um avi√£o tem centenas de bot√µes, mas o mais importante √© o c√©rebro do piloto, que precisa tomar decis√µes r√°pidas em segundos. √â a profiss√£o de quem quer ver o mundo de cima!`,

            direito2: `Malu, voc√™ sabia que existem leis t√£o antigas e estranhas que ainda est√£o nos livros? Na Inglaterra, por exemplo, existe uma lei de centenas de anos que diz que todos os cisnes do pa√≠s pertencem √† Rainha (ou ao Rei)! Ser advogada √© entender que as leis mudam conforme a sociedade cresce. Antigamente, as mulheres nem podiam votar, e foram advogadas corajosas que lutaram para mudar isso. O Direito protege at√© as suas ideias! Se voc√™ criar um desenho ou uma hist√≥ria, o Direito Autoral garante que ningu√©m possa copiar sem sua permiss√£o. Uma advogada de sucesso precisa ser muito curiosa e gostar de investigar. √Äs vezes, a solu√ß√£o de um caso n√£o est√° no que as pessoas dizem, mas num pequeno detalhe num documento esquecido. Voc√™ sabia que a primeira advogada do Brasil foi uma mulher negra chamada Esperan√ßa Garcia? Ela escreveu uma carta ao governador pedindo direitos e justi√ßa muito antes de ser comum mulheres estudarem. Isso mostra que o Direito √© a ferramenta mais forte que temos para mudar o mundo e defender quem n√£o pode se defender sozinho!`,

            medicina2: `Prepare o seu estetosc√≥pio, Dra. Malu, porque essa √© de arrepiar: o c√©rebro humano √© o "mestre" do corpo, mas ele mesmo n√£o sente dor! Se um m√©dico tocasse no c√©rebro durante uma cirurgia, o paciente n√£o sentiria nada, porque o c√©rebro n√£o tem receptores de dor. Ele sente a dor de todo o resto do corpo, mas se esquece de si mesmo. Sabia que o seu cora√ß√£o bate cerca de 100 mil vezes por dia? Ele √© o motor que nunca para. E tem mais: os m√©dicos descobriram que o riso realmente √© um rem√©dio! Quando voc√™ ri, seu corpo solta subst√¢ncias que ajudam a curar doen√ßas e relaxar os m√∫sculos. Na medicina do futuro, os m√©dicos usar√£o min√∫sculas c√¢meras que voc√™ engole como se fosse uma p√≠lula para ver tudo por dentro sem precisar de cortes. Ser m√©dica exige que voc√™ seja uma eterna estudante, pois cada pessoa √© um universo diferente. Voc√™ sabia que temos mais bact√©rias no corpo do que estrelas na nossa gal√°xia? Mas n√£o se assuste, a maioria delas s√£o nossas amigas e nos ajudam a crescer fortes!`,

            arquitetura2: `Malu, imagine construir um castelo inteirinho sem usar um pingo de cimento ou cola. Os antigos Incas faziam isso! Eles cortavam as pedras com tanta perfei√ß√£o que elas se encaixavam como um Lego gigante, e nem uma folha de papel passava entre elas. Isso √© arquitetura de alto n√≠vel! Hoje, os arquitetos est√£o criando pr√©dios que "respiram". Em Mil√£o, existem pr√©dios chamados "Bosque Vertical", que s√£o cobertos por centenas de √°rvores e plantas que limpam o ar da cidade. Sabia que a cor das paredes da sua escola ou do seu quarto pode mudar o seu humor? Arquitetos estudam a psicologia das cores: o azul acalma, o amarelo d√° energia e o verde ajuda a focar nos estudos. Um arquiteto tamb√©m precisa ser um pouco engenheiro espacial: j√° existem projetos de casas para Marte que seriam feitas de gelo ou solo de l√° mesmo para proteger os astronautas da radia√ß√£o. Desenhar uma casa √© desenhar o cen√°rio onde a vida de uma fam√≠lia vai acontecer. √â criar um lugar seguro, bonito e m√°gico para as pessoas viverem seus sonhos!`,

            piloto2: `Malu, voc√™ tem medo de tempestades? Pois saiba que os avi√µes s√£o atingidos por raios o tempo todo e nada acontece com quem est√° dentro! Isso acontece porque o avi√£o funciona como uma "Gaiola de Faraday" ‚Äì a eletricidade corre por fora da fuselagem e vai embora sem dar nem um choquinho nos passageiros. Incr√≠vel, n√©? Outra curiosidade: os pneus de um avi√£o s√£o cheios de nitrog√™nio para n√£o explodirem com o calor imenso do pouso. E voc√™ sabia que o ar que voc√™ respira dentro do avi√£o √© mais limpo que o ar de muitos escrit√≥rios, porque passa por filtros super potentes iguais aos dos hospitais? Ser piloto √© ter uma vis√£o de √°guia. Eles usam radares que mostram as nuvens de chuva a quil√¥metros de dist√¢ncia, permitindo que o avi√£o desvie e o voo continue calmo. Quando um piloto decola, ele entra em um mundo onde as nuvens s√£o o ch√£o e o sol brilha quase o tempo todo acima delas. √â uma profiss√£o de liberdade, mas de muita responsabilidade, pois o piloto √© o guardi√£o de todas as vidas que est√£o l√° no c√©u com ele!`,

            extra1: `Voc√™ j√° ouviu falar em Engenharia de Minas Espacial? Malu, no futuro, os profissionais v√£o minerar asteroides para buscar diamantes e metais preciosos! O espa√ßo √© a nova fronteira das profiss√µes. Existem pessoas que trabalham hoje apenas para criar comidas que n√£o flutuam no espa√ßo, para que os astronautas possam comer sem fazer bagun√ßa. Sabia que no espa√ßo os astronautas ficam mais altos? Sem a gravidade da Terra empurrando para baixo, a coluna estica um pouquinho! No Direito, j√° existem discuss√µes sobre quem seria o "dono" de um terreno na Lua. Na Medicina, estudam como o cora√ß√£o se comporta quando n√£o existe peso. O futuro est√° cheio de profiss√µes que ainda nem t√™m nome, e todas elas precisam de algu√©m que goste de ler, pesquisar e nunca parar de perguntar "por que?". Quem sabe voc√™ n√£o ser√° a primeira advogada ou m√©dica a trabalhar em uma esta√ß√£o espacial fora da Terra? O universo √© literalmente o limite!`,

            extra2: `Voc√™ sabia que existem "Designers de Sonhos" na vida real? S√£o os arquitetos e engenheiros que criam os parques da Disney! Eles s√£o chamados de "Imagineers". Eles misturam contos de fadas com alta tecnologia para criar experi√™ncias que parecem m√°gicas. Para ser um deles, voc√™ precisa ser bom em matem√°tica, mas tamb√©m ter uma imagina√ß√£o gigante. Eles estudam at√© o cheiro dos lugares! Sabia que na Disney eles soltam cheiro de pipoca e baunilha nas ruas para que voc√™ se sinta feliz e com fome? Isso √© design sensorial. Outra profiss√£o incr√≠vel √© a de Arque√≥logo Subaqu√°tico, que explora cidades que afundaram h√° milhares de anos. Ser um profissional de sucesso √© saber que voc√™ pode misturar seus hobbies com o seu trabalho. Se voc√™ gosta de desenhar e de justi√ßa, pode ser uma arquiteta de tribunais. Se gosta de beb√™s e de ci√™ncia, pode ser uma m√©dica pediatra. O mundo √© como uma tela em branco, e seus estudos s√£o os pinc√©is que voc√™ vai usar para pintar o seu futuro!`,
        };

        function openCuriosities() {
            updateCuriosityHeader();
            document.getElementById('curiosity-display').style.display = 'none';
            document.getElementById('curiosity-buttons').style.display = 'grid';
            document.getElementById('curiosity-modal').style.display = 'flex';
        }

        function updateCuriosityHeader() {
            const modalContent = document.querySelector('#curiosity-modal .modal-content');
            let limitInfo = document.getElementById('limit-info');

            if (!limitInfo) {
                limitInfo = document.createElement('div');
                limitInfo.id = 'limit-info';
                limitInfo.className = 'daily-limit-info';
                modalContent.insertBefore(limitInfo, document.getElementById('curiosity-buttons'));
            }

            limitInfo.innerText = `Voc√™ j√° viu ${curiositiesViewedToday} de ${MAX_CURIOSITIES_PER_DAY} curiosidades de hoje!`;
        }

        function showCuriosity(key) {
            if (curiositiesViewedToday >= MAX_CURIOSITIES_PER_DAY) {
                alert("Malu, voc√™ j√° aprendeu 2 curiosidades hoje! Amanh√£ tem mais. üåü");
                return;
            }

            const display = document.getElementById('curiosity-display');
            const buttons = document.getElementById('curiosity-buttons');
            curiosityTimeLeft = 4 * 60; // 4 minutos obrigat√≥rios

            display.innerHTML = `
            <p>${curiosidadesReais[key]}</p>
            <div id="curiosity-timer-box" style="color:var(--dark-pink); font-weight:bold; margin: 10px 0;">
                Aguarde <span id="c-timer">4:00</span> para resgatar seu pr√™mio...
            </div>
            <button id="claim-c-btn" class="btn" style="display:none; background:var(--yellow); color:#333;" onclick="claimCuriosityReward()">
                Pegar meu pr√™mio (+10 min) üéÅ
            </button>`;

            buttons.style.display = 'none';
            display.style.display = 'block';

            clearInterval(curiosityTimer);
            curiosityTimer = setInterval(() => {
                curiosityTimeLeft--;
                let m = Math.floor(curiosityTimeLeft / 60);
                let s = curiosityTimeLeft % 60;
                document.getElementById('c-timer').innerText = `${m}:${s < 10 ? '0' + s : s}`;

                if (curiosityTimeLeft <= 0) {
                    clearInterval(curiosityTimer);
                    document.getElementById('curiosity-timer-box').style.display = 'none';
                    document.getElementById('claim-c-btn').style.display = 'inline-block';
                }
            }, 1000);
        }

        function claimCuriosityReward() {
            curiositiesViewedToday++;
            totalMinutes += 10;
            document.getElementById('total-min').innerText = totalMinutes;
            closeModal('curiosity-modal');
            checkAllDone();
        }

        async function gerarECompartilharCertificado() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: "landscape", unit: "mm", format: "a5" });
            const hoje = new Date().toLocaleDateString('pt-BR');

            // ... (Mantenha o design do seu certificado atual) ...

            const nomeArquivo = `Certificado_Malu_${hoje.replace(/\//g, '-')}.pdf`;
            doc.save(nomeArquivo);

            // Preparar mensagem com link do √°udio
            let mensagemTexto = `üöÄ PAPAI! Eu completei todas as minhas miss√µes de hoje (${hoje})!\n\n`;
            mensagemTexto += `‚ú® Ganhei um total de ${totalMinutes} minutos.\n`;

            if (audioUrlParaEnviar) {
                mensagemTexto += `üéôÔ∏è OU√áA MINHA LEITURA: A grava√ß√£o est√° salva no meu celular! Eu li a hist√≥ria de ${currentStoryKey.toUpperCase()}.`;
            }

            mensagemTexto += `\n\nPosso usar meu tempo? üíñ`;

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(mensagemTexto)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Backup Autom√°tico JSON
        function fazerBackupAuto() {
            // Mostra o popup l√∫dico
            document.getElementById('backup-modal').style.display = 'flex';

            setTimeout(() => {
                const dados = {
                    totalMinutes: totalMinutes,
                    data: new Date().toLocaleDateString(),
                    missoes: missionsCompletedCount
                };

                const blob = new Blob([JSON.stringify(dados)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `memorias_da_malu.json`;
                a.click();

                // Esconde o popup ap√≥s 2.5 segundos
                setTimeout(() => {
                    closeModal('backup-modal');
                }, 500);
            }, 2000);
        }

        // Chame fazerBackupAuto() dentro da sua fun√ß√£o gerarECompartilharCertificado()

        function restaurarBackup(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    totalMinutes = dados.totalMinutes;
                    updateDisplay(); // Atualiza a tela com os minutos recuperados
                    alert("Informa√ß√µes recuperadas com sucesso! üåà");
                } catch (err) {
                    alert("Erro ao ler o arquivo de backup.");
                }
            };
            reader.readAsText(file);
        }
    </script>

    <button class="floating-btn" onclick="openCuriosities()">üí° Curiosidades Reais</button>

    <div id="curiosity-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h2 style="font-family: 'Fredoka One'; color: var(--purple);">‚ú® Segredos das Profiss√µes</h2>
            <p>Escolha um tema para descobrir algo incr√≠vel!</p>

            <div class="curiosity-grid" id="curiosity-buttons">
                <button class="curiosity-item-btn" onclick="showCuriosity('direito1')">‚öñÔ∏è O Tribunal de 4 mil
                    Anos</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('medicina1')">ü©∫ O Primeiro
                    Estetosc√≥pio</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('arquitetura1')">üèóÔ∏è Cidades que
                    Flutuam</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('piloto1')">‚úàÔ∏è Por que Avi√µes n√£o
                    Caem?</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('direito2')">üìú A Lei mais Estranha</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('medicina2')">üß† O C√©rebro n√£o Sente
                    Dor</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('arquitetura2')">üè∞ Castelos sem
                    Cimento</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('piloto2')">üå©Ô∏è Raios no Avi√£o</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('extra1')">üíé A Profiss√£o do Espa√ßo</button>
                <button class="curiosity-item-btn" onclick="showCuriosity('extra2')">üé® Designers de Sonhos</button>
            </div>

            <div id="curiosity-display" class="curiosity-text-area"></div>

            <button class="btn" style="margin-top:20px; width:100%" onclick="closeModal('curiosity-modal')">Fechar
                Curiosidades</button>
        </div>
    </div>

    <div id="welcome-modal" class="modal" style="display:flex">
        <div class="modal-content" style="border: 10px solid var(--sky); background: #fff;">
            <h1 style="font-size: 5rem; margin-bottom: 10px;">‚òÄÔ∏è</h1>
            <h2 style="color: var(--purple); font-family: 'Fredoka One'; font-size: 2.5rem;">Bom dia, Malu!</h2>
            <p style="font-size: 1.3rem; font-weight: bold; color: var(--dark-pink);">
                O sol j√° nasceu no seu mundo m√°gico! ‚ú®
            </p>
            <p style="font-size: 1.1rem; margin: 20px 0;">
                Voc√™ est√° pronta para brilhar hoje e completar suas miss√µes super divertidas?
                Cada tarefa conclu√≠da te deixa mais perto dos seus sonhos de ser uma grande profissional!
            </p>
            <button class="btn" style="font-size: 1.5rem; padding: 15px 40px; background: var(--yellow); color: #333;"
                onclick="closeModal('welcome-modal')">
                SIM, ESTOU PRONTA! üöÄ
            </button>
        </div>
    </div>

    <div id="game-modal" class="modal">
        <div class="modal-content">
            <h2 style="font-family: 'Fredoka One'; color: var(--purple);">üß© Desafio da Malu</h2>
            <p>Monte o quebra-cabe√ßa para ganhar 45min!</p>
            <div id="game-timer">15:00</div>

            <div id="puzzle-container"></div>

            <div style="margin-top: 15px;">
                <button class="btn" style="background:var(--dark-pink)" onclick="desistirJogo()">Desistir
                    (-30min)</button>
            </div>
        </div>
    </div>

    <div id="game-locked-modal" class="modal">
        <div class="modal-content" style="border-color: var(--yellow);">
            <h1 style="font-size: 3rem; margin: 0;">üöß</h1>
            <h2 style="color: var(--purple); font-family: 'Fredoka One';">Quase l√°, Malu!</h2>
            <p>Para liberar o <b>Jogo Inteligente</b>, voc√™ precisa completar:</p>

            <div id="check-list-container"
                style="text-align: left; background: #f9f9f9; padding: 15px; border-radius: 20px; margin: 10px 0; border: 2px dashed var(--sky);">
                <div id="check-missions" style="margin-bottom: 8px;">‚è≥ Miss√µes (0/5)</div>
                <div id="check-reading" style="margin-bottom: 8px;">‚è≥ Leitura da Hist√≥ria</div>
                <div id="check-curiosity" style="margin-bottom: 8px;">‚è≥ 2 Curiosidades Reais</div>
            </div>

            <button class="btn" style="background: var(--yellow); color: #333; width: 100%;"
                onclick="closeModal('game-locked-modal')">
                Vou terminar agora! üöÄ
            </button>
        </div>
        <span class="close-popup" onclick="fecharLeitura()">√ó</span>

        <button class="btn-restore-hidden" onclick="document.getElementById('fileInput').click()">‚öôÔ∏è</button>
        <input type="file" id="fileInput" style="display:none" onchange="restaurarBackup(event)">
    </div>
    <div id="custom-alert-modal" class="modal">
        <div class="modal-content" style="border-color: var(--pink);">
            <h1 id="custom-alert-emoji" style="font-size: 3rem; margin: 0;">üåü</h1>
            <h2 id="custom-alert-title" style="color: var(--purple); font-family: 'Fredoka One';">Aviso</h2>
            <p id="custom-alert-message" style="font-size: 1.1rem;"></p>
            <button class="btn" style="width: 100%;" onclick="closeModal('custom-alert-modal')">OK!</button>
        </div>
    </div>

    <div id="custom-confirm-modal" class="modal">
        <div class="modal-content" style="border-color: var(--yellow);">
            <h1 style="font-size: 3rem; margin: 0;">ü§î</h1>
            <h2 style="color: var(--purple); font-family: 'Fredoka One';">Tem certeza?</h2>
            <p id="custom-confirm-message" style="font-size: 1.1rem;"></p>
            <div style="display: flex; gap: 10px; width: 100%;">
                <button id="confirm-yes" class="btn" style="background: var(--dark-pink); flex: 1;">Sim, quero
                    sair</button>
                <button class="btn" style="background: var(--sky); color: #333; flex: 1;"
                    onclick="closeModal('custom-confirm-modal')">N√£o, vou ficar</button>
            </div>
        </div>
    </div>
</body>

</html>
