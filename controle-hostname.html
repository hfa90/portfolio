<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CD Inventory Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        input,
        select,
        button {
            font-size: 16px !important;
            touch-action: manipulation;
        }

        body {
            -webkit-tap-highlight-color: transparent;
            background-color: #f2f2f7;
        }

        .ios-card {
            background: white;
            border-radius: 14px;
            border: 1px solid #e5e5ea;
        }

        .btn-action {
            transition: all 0.2s;
        }

        .btn-action:active {
            transform: scale(0.96);
            opacity: 0.8;
        }
    </style>
</head>

<body class="font-sans text-gray-900 pb-20">

    <div class="max-w-md mx-auto px-4 pt-8">
        <header class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-3xl font-extrabold tracking-tight text-black">Invent치rio CD</h1>
                <p class="text-gray-500 font-medium">Gest칚o de Ativos</p>
            </div>
            <div id="counter"
                class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-bold shadow-lg shadow-blue-200">0
            </div>
        </header>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <button onclick="exportToExcel()"
                class="btn-action bg-green-600 text-white p-3 rounded-xl flex flex-col items-center justify-center shadow-sm">
                <span class="text-xs uppercase font-bold">Gerar Excel</span>
            </button>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="exportBackup()"
                    class="btn-action bg-gray-800 text-white rounded-xl text-[10px] uppercase font-bold">Backup</button>
                <label
                    class="btn-action bg-white border border-gray-300 rounded-xl text-[10px] uppercase font-bold flex items-center justify-center cursor-pointer">
                    Restaurar
                    <input type="file" id="importFile" class="hidden" onchange="importBackup(event)">
                </label>
            </div>
        </div>

        <section class="ios-card p-5 mb-8 shadow-sm">
            <form id="pcForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1 ml-1">Hostname</label>
                        <input type="text" id="hostname" required placeholder="Ex: CD-01"
                            class="w-full p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 border-none transition-all">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1 ml-1">Data</label>
                        <input type="date" id="dataInventario" required
                            class="w-full p-3 bg-gray-50 rounded-xl outline-none border-none">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1 ml-1">Setor</label>
                    <input type="text" id="setor" required placeholder="Ex: Log칤stica"
                        class="w-full p-3 bg-gray-50 rounded-xl outline-none border-none">
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1 ml-1">Status</label>
                    <select id="status"
                        class="w-full p-3 bg-gray-50 rounded-xl outline-none border-none appearance-none">
                        <option value="Em opera칞칚o">游릭 Em opera칞칚o</option>
                        <option value="Backup">游리 Backup</option>
                    </select>
                </div>

                <button type="submit"
                    class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl btn-action shadow-lg shadow-blue-100">
                    Registrar Computador
                </button>
            </form>
        </section>

        <div id="pcList" class="space-y-3"></div>
    </div>

    <script>
        let inventory = JSON.parse(localStorage.getItem('cd_inventory_v2')) || [];

        // Define a data de hoje como padr칚o no input
        document.getElementById('dataInventario').valueAsDate = new Date();

        function render() {
            const pcList = document.getElementById('pcList');
            pcList.innerHTML = '';
            document.getElementById('counter').innerText = inventory.length;

            inventory.forEach((pc, index) => {
                const div = document.createElement('div');
                div.className = 'ios-card p-4 flex justify-between items-center shadow-sm';
                div.innerHTML = `
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-gray-900">${pc.hostname}</span>
                            <span class="text-[10px] text-gray-400">${pc.data.split('-').reverse().join('/')}</span>
                        </div>
                        <div class="text-sm text-gray-500">${pc.setor}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-[11px] font-bold ${pc.status === 'Backup' ? 'text-orange-500' : 'text-green-600'} mb-1 uppercase">${pc.status}</div>
                        <button onclick="removePc(${index})" class="text-red-400 text-xs active:text-red-600">Remover</button>
                    </div>
                `;
                pcList.appendChild(div);
            });
            localStorage.setItem('cd_inventory_v2', JSON.stringify(inventory));
        }

        document.getElementById('pcForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const newPc = {
                hostname: document.getElementById('hostname').value,
                setor: document.getElementById('setor').value,
                status: document.getElementById('status').value,
                data: document.getElementById('dataInventario').value
            };
            inventory.unshift(newPc);
            render();
            document.getElementById('pcForm').reset();
            document.getElementById('dataInventario').valueAsDate = new Date();
        });

        function removePc(index) {
            if (confirm('Excluir este registro?')) {
                inventory.splice(index, 1);
                render();
            }
        }

        // --- FUN칂칏ES DE EXPORTA칂츾O E BACKUP ---

        function exportToExcel() {
            if (inventory.length === 0) return alert('Lista vazia!');

            const ws = XLSX.utils.json_to_sheet(inventory.map(item => ({
                "Hostname": item.hostname,
                "Setor": item.setor,
                "Status": item.status,
                "Data Invent치rio": item.data
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Invent치rio");
            XLSX.writeFile(wb, `Inventario_CD_${new Date().toLocaleDateString()}.xlsx`);
        }

        function exportBackup() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(inventory));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "backup_inventario.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function importBackup(event) {
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        inventory = imported;
                        render();
                        alert('Backup restaurado com sucesso!');
                    }
                } catch (err) {
                    alert('Erro ao ler arquivo de backup.');
                }
            };
            reader.readAsText(event.target.files[0]);
        }

        render();
    </script>
</body>

</html>